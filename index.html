<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Br√∫jula ‚Üí Londres</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body {
    background:#0a0a0f; color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;
    height:100dvh; display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    overflow:hidden; user-select:none;
  }
  #splash {
    position:fixed; inset:0; background:#0a0a0f;
    display:flex; flex-direction:column; align-items:center;
    justify-content:center; gap:20px; z-index:100; padding:40px;
  }
  #splash .icon { font-size:64px; }
  #splash h1 { font-size:28px; font-weight:300; text-align:center; }
  #splash p  { font-size:15px; color:#888; text-align:center; line-height:1.6; max-width:280px; }
  #splash .btn {
    padding:18px 0; background:#fff; color:#000; border:none;
    border-radius:50px; font-size:17px; font-weight:700;
    width:100%; max-width:280px; cursor:pointer;
  }
  #splash .btn:active { opacity:0.75; }
  #splash .note { font-size:11px; color:#3a3a3a; text-align:center; max-width:260px; }
  #splash.hidden { display:none; }
  #app { display:none; flex-direction:column; align-items:center; justify-content:center; width:100%; height:100%; }
  .title { font-size:12px; letter-spacing:4px; text-transform:uppercase; color:#555; margin-bottom:10px; }
  .hdg { font-size:58px; font-weight:200; letter-spacing:-2px; font-variant-numeric:tabular-nums; min-width:130px; text-align:center; }
  .crd { font-size:15px; color:#666; letter-spacing:3px; margin-bottom:36px; min-height:22px; }
  .wrap { position:relative; width:290px; height:290px; }
  canvas { position:absolute; inset:0; border-radius:50%; }
  .dot { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:10px; height:10px; background:#fff; border-radius:50%; z-index:10; box-shadow:0 0 10px rgba(255,255,255,.9); }
  .ptr { position:absolute; top:50%; left:50%; width:114px; height:2px; transform-origin:4px 50%; z-index:9; }
  .fw { position:absolute; right:-34px; top:-24px; display:flex; flex-direction:column; align-items:center; }
  .flag { width:30px; height:20px; border-radius:2px; overflow:hidden; display:flex; flex-direction:column; box-shadow:0 2px 10px rgba(0,0,0,.8); }
  .r { background:#AA151B; flex:1; }
  .y { background:#F1BF00; flex:1.6; }
  .pole { width:2px; height:24px; background:#aaa; margin-left:1px; }
  .lbl { position:absolute; right:-62px; top:30px; font-size:9px; font-weight:700; letter-spacing:1.5px; color:#F1BF00; text-transform:uppercase; white-space:nowrap; text-shadow:0 1px 4px #000; }
  .info { margin-top:32px; display:flex; flex-direction:column; align-items:center; gap:8px; }
  .ldeg { font-size:13px; color:#666; }
  .ldeg span { color:#F1BF00; font-weight:600; }
  .st { font-size:11px; color:#444; letter-spacing:1px; }
  .st.ok  { color:#2ecc71; }
  .st.err { color:#e74c3c; }
</style>
</head>
<body>
<div id="splash">
  <div class="icon">üß≠</div>
  <h1>Br√∫jula ‚Üí Londres</h1>
  <p>Necesita acceso al sensor de movimiento del dispositivo.</p>
  <button class="btn" id="startBtn">Activar br√∫jula</button>
  <p class="note">Ubicaci√≥n usada solo para calcular el rumbo. No se guarda ni env√≠a.</p>
</div>
<div id="app">
  <div class="title">Br√∫jula</div>
  <div class="hdg" id="hdg">---</div>
  <div class="crd" id="crd">&nbsp;</div>
  <div class="wrap">
    <canvas id="cv" width="290" height="290"></canvas>
    <div class="ptr" id="ptr">
      <div class="fw">
        <div class="flag"><div class="r"></div><div class="y"></div><div class="r"></div></div>
        <div class="pole"></div>
        <div class="lbl">Londres</div>
      </div>
    </div>
    <div class="dot"></div>
  </div>
  <div class="info">
    <div class="ldeg">Londres: <span id="lbear">--</span>¬∞ desde tu posici√≥n</div>
    <div class="st" id="st">Esperando sensor...</div>
  </div>
</div>
<script>
  var uLat=40.4168, uLng=-3.7038;
  var LON_LAT=51.5074, LON_LNG=-0.1278;
  var cH=0, tH=0, lB=315, ready=false;
  document.getElementById('startBtn').onclick = function() {
    if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
      DeviceOrientationEvent.requestPermission().then(function(state) {
        if (state === 'granted') { launch(); }
        else { alert('Permiso denegado.

Ve a: Ajustes ‚Üí Safari ‚Üí Configuraci√≥n de sitios web ‚Üí Movimiento y orientaci√≥n ‚Üí Permitir'); }
      }).catch(function() { launch(); });
    } else { launch(); }
  };
  function launch() {
    document.getElementById('splash').classList.add('hidden');
    document.getElementById('app').style.display = 'flex';
    window.addEventListener('deviceorientation', onOri, true);
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(p) {
        uLat=p.coords.latitude; uLng=p.coords.longitude;
        lB=bear(uLat,uLng,LON_LAT,LON_LNG);
        document.getElementById('lbear').textContent=Math.round(lB);
      }, function() { lB=bear(uLat,uLng,LON_LAT,LON_LNG); document.getElementById('lbear').textContent=Math.round(lB); });
    } else { lB=bear(uLat,uLng,LON_LAT,LON_LNG); document.getElementById('lbear').textContent=Math.round(lB); }
    requestAnimationFrame(loop);
  }
  function onOri(e) {
    var h=null;
    if (e.webkitCompassHeading!=null) { h=e.webkitCompassHeading; }
    else if (e.alpha!=null) { h=(360-e.alpha)%360; }
    if (h!=null && !isNaN(h)) {
      tH=h;
      if (!ready) { ready=true; document.getElementById('st').textContent='‚óè Sensor activo'; document.getElementById('st').className='st ok'; }
      var r=Math.round(h);
      document.getElementById('hdg').textContent=r+'¬∞';
      document.getElementById('crd').textContent=card(r);
    }
  }
  function bear(a,b,c,d) {
    var r=function(x){return x*Math.PI/180};
    var dl=r(d-b),f1=r(a),f2=r(c);
    return(Math.atan2(Math.sin(dl)*Math.cos(f2),Math.cos(f1)*Math.sin(f2)-Math.sin(f1)*Math.cos(f2)*Math.cos(dl))*180/Math.PI+360)%360;
  }
  function card(d) { return['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSO','SO','OSO','O','ONO','NO','NNO'][Math.round(d/22.5)%16]; }
  var cv=document.getElementById('cv'), ctx=cv.getContext('2d');
  var W=290, C=145, R=136;
  function draw(a) {
    ctx.clearRect(0,0,W,W);
    var bg=ctx.createRadialGradient(C,C,10,C,C,R);
    bg.addColorStop(0,'#18182a'); bg.addColorStop(1,'#0a0a14');
    ctx.fillStyle=bg; ctx.beginPath(); ctx.arc(C,C,R,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#252540'; ctx.lineWidth=1.5; ctx.stroke();
    for(var i=0;i<360;i+=5){
      var rad=((i-a)*Math.PI)/180;
      var maj=i%90===0, med=i%45===0&&!maj, t10=i%10===0&&!med&&!maj;
      var inn=maj?R-26:med?R-18:t10?R-12:R-8;
      ctx.strokeStyle=maj?'#fff':t10?'#555':'#2e2e2e'; ctx.lineWidth=maj?2:1;
      ctx.beginPath();
      ctx.moveTo(C+Math.sin(rad)*inn, C-Math.cos(rad)*inn);
      ctx.lineTo(C+Math.sin(rad)*(R-4), C-Math.cos(rad)*(R-4));
      ctx.stroke();
    }
    [{l:'N',d:0,c:'#e74c3c',s:17},{l:'S',d:180,c:'#eee',s:14},{l:'E',d:90,c:'#eee',s:14},{l:'O',d:270,c:'#eee',s:14}]
    .forEach(function(x){
      var rad=((x.d-a)*Math.PI)/180;
      ctx.fillStyle=x.c; ctx.font='bold '+x.s+'px -apple-system,sans-serif';
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText(x.l, C+Math.sin(rad)*(R-36), C-Math.cos(rad)*(R-36));
    });
    ctx.beginPath(); ctx.moveTo(C,C-50); ctx.lineTo(C-5,C); ctx.lineTo(C+5,C); ctx.closePath(); ctx.fillStyle='#e74c3c'; ctx.fill();
    ctx.beginPath(); ctx.moveTo(C,C+36); ctx.lineTo(C-5,C); ctx.lineTo(C+5,C); ctx.closePath(); ctx.fillStyle='#ddd'; ctx.fill();
    ctx.beginPath(); ctx.arc(C,C,5,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.fill();
  }
  function lerp(a,b,t){ var d=b-a; while(d>180)d-=360; while(d<-180)d+=360; return a+d*t; }
  function loop(){ cH=lerp(cH,tH,0.1); draw(cH); document.getElementById('ptr').style.transform='translate(-4px,-1px) rotate('+(lB-cH)+'deg)'; requestAnimationFrame(loop); }
  draw(0);
</script>
</body>
</html>
